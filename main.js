(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var c=n.getElementsByTagName("script");c.length&&(t=c[c.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new XMLHttpRequest;if("GET"===e.method)try{t.open(e.method,e.url),t.send()}catch(t){e.callback(new Error(t.messange),null)}else{const n=new FormData;for(const t in e.data)n.append(t,e.data[t]),console.log(e.data);try{t.open(e.method,e.url),t.send(n)}catch(t){e.callback(new Error(t.messange),null)}}t.onload=function(){200===t.status?e.callback(null,t.response):e.callback(t.err,null)}},n=e.p+"ded549d5c2a86d3174f4.png",c=e.p+"2da8e18177e4c2518bc3.png",a=e.p+"a7e5e6815ce9a721ebff.png",o=e.p+"8875037f10923033af27.png";class s{constructor(e,t,n,c,a){this.N=e,this.D=t,this.S=n,this.C=c,this.I=a}creatTicket(){const e=document.createElement("div");e.className="tiket_content",e.id=this.I;const t=document.createElement("label");t.className="label";const l=document.createElement("input");l.type="checkbox",l.className="input";const r=document.createElement("img");r.className="img","true"===this.S?(r.src=`${n}`,l.checked=!0):(r.src=`${c}`,l.checked=!1),t.append(l,r),e.append(t);const d=document.createElement("div");d.className="title",d.textContent=this.N,e.append(d);const i=document.createElement("div");if(i.className="time",this.C)i.textContent=this.C;else{const e=s.getTime();i.textContent=e}e.append(i);const u=document.createElement("div");u.className="editing";const m=document.createElement("img");m.src=`${a}`,u.append(m),e.append(u);const p=document.createElement("div");p.className="delete";const h=document.createElement("img");h.src=`${o}`,p.append(h),e.append(p);const g=document.createElement("div");return g.className="full_text",g.textContent=this.D,e.append(g),e}static getTime(){const e=new Date,t=e.getFullYear().toString().slice(2),n=e.getMonth()<10?`0${e.getMonth()+1}`:e.getMonth()+1;return`${e.getDate()<10?`0${e.getDate()}`:e.getDate()}.${n}.${t} ${e.getHours()<10?`0${e.getHours()}`:e.getHours()}:${e.getMinutes()<10?`0${e.getMinutes()}`:e.getMinutes()}`}}class l{constructor(e){e?(this.sh=e.sh,this.fu=e.fu,this.formHead="Редактировать тикет"):(this.sh="",this.fu="",this.formHead="Добавить тикет")}creatForm(){const e=document.createElement("form");e.className="popov",e.novalidate=!0;const t=document.createElement("h3");t.className="head_pop",t.textContent=this.formHead,e.append(t);const n=document.createElement("label");n.textContent="Краткое описание";const c=document.createElement("input");c.type="text",c.className="inp",c.name="short",c.required=!0,c.value=this.sh,n.append(c),e.append(n);const a=document.createElement("label");a.textContent=" Подробное описание";const o=document.createElement("textarea");o.className="inp",o.classList.add("full"),o.name="full",o.required=!0,o.value=this.fu,a.append(o),e.append(a);const s=l.addButt();return e.append(s),e}static warning(){const e=document.createElement("div");e.id="dt",e.className="popov",e.classList.add("warning"),e.name="war",e.novalidate=!0;const t=document.createElement("h3");t.className="head_pop",t.textContent="Удалить тикет",e.append(t);const n=document.createElement("div");n.className="full_text",n.classList.add("warn"),n.textContent="Вы действительно хотите удалить этот тикет?",e.append(n);const c=l.addButt();return e.append(c),e}static addButt(){const e=document.createElement("div");e.className="block_button";const t=document.createElement("button");t.className="but",t.type="reset",t.textContent="Отмена",t.id="res",e.append(t);const n=document.createElement("button");return n.className="but",n.id="sav",n.textContent="Ok",e.append(n),e}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class d{constructor(){this.addT=document.getElementById("addT"),this.init()}init(){window.addEventListener("load",(()=>{t({method:"GET",url:d.addUrl,callback:(e,t)=>{t?d.hendlerTicket(t):console.log(`Ошибка...${e}`)}})})),this.addT.addEventListener("click",d.addTiket)}static hendlerTicket(e){const{tasks:t}=JSON.parse(e);t.forEach((e=>{const{name:t,discription:n,check:c,creat:a,id:o}=e,l=new s(t,n,c,a,o).creatTicket();d.handHandler(l),d.tikets.append(l)}))}static handHandler(e){e.querySelector(".label").addEventListener("click",d.triggerChek),e.querySelector(".title").addEventListener("click",d.showDiscription),e.querySelector(".time").addEventListener("click",d.showDiscription),e.querySelector(".editing").addEventListener("click",d.editTiket),e.querySelector(".delete").addEventListener("click",d.deleteTiket)}static triggerChek(e){const n=e.target.closest(".label").querySelector(".input"),c=e.target.closest(".tiket_content").id;n.onchange=()=>{n.checked?t({method:"PUT",url:d.addUrl,data:{id:c,check:!0},callback:(e,t)=>{t?window.location.reload():console.log(`Ошибка...${e}`)}}):t({method:"PUT",url:d.addUrl,data:{id:c,check:!1},callback:(e,t)=>{t?window.location.reload():console.log(`Ошибка...${e}`)}})}}static showDiscription(e){const t=e.target.closest(".tiket_content").querySelector(".full_text");"block"===t.style.display?t.style.display="none":t.style.display="block"}static addTiket(){const e=(new l).creatForm();d.tikets.append(e),e.res.addEventListener("click",(()=>e.remove())),e.sav.addEventListener("click",(n=>{if(n.preventDefault(),!e.short.value)return alert('Поле "Краткое описание" - не заполнено.'),void e.remove();if(!e.full.value)return alert('Поле "Подробное описание" - не заполнено.'),void e.remove();const c=e.short.value,a=e.full.value;e.remove();const o=s.getTime();console.log(o),t({method:"POST",url:d.addUrl,data:{check:!1,name:c,creat:o,discription:a},callback:(e,t)=>{t?window.location.reload():console.log(`Ошибка...${e}`)}})}))}static editTiket(e){const n=e.target.closest(".tiket_content"),c=n.querySelector(".title"),a=n.querySelector(".full_text"),o={sh:[c.textContent],fu:[a.textContent]},r=new l(o).creatForm();d.tikets.append(r),r.res.addEventListener("click",(()=>r.remove())),r.sav.addEventListener("click",(n=>{n.preventDefault();const c=e.target.closest(".tiket_content").id,a=r.short.value,o=r.full.value,l=s.getTime();console.log(c,a,o),r.remove(),t({method:"PUT",url:d.addUrl,data:{id:c,name:a,creat:l,discription:o},callback:(e,t)=>{t?window.location.reload():console.log(`Ошибка...${e}`)}})}))}static deleteTiket(e){const n=l.warning(),c=e.target.closest(".tiket_content").id;d.tikets.append(n);const a=document.getElementById("res"),o=document.getElementById("sav");a.addEventListener("click",(()=>n.remove())),o.addEventListener("click",(e=>{e.preventDefault(),n.remove(),t({method:"PUT",url:d.addUrl,data:{id:c,method:"delete"},callback:(e,t)=>{t?window.location.reload():console.log(`Ошибка...${e}`)}})}))}}r(d,"addUrl","https://coursar-http.herokuapp.com/"),r(d,"tikets",document.querySelector(".tikets")),new d})();